/*
  * b4-table - An extended Bootstrap table based on boostrap4.
  *
  * @version v0.0.1
  * @author Hikamai <1450206741@qq.com> (https://github.com/Gu-Miao)
  * @github (https://github.com/Gu-Miao/b4-table)
  * @license MIT
  */
function Table(){this.dataRendering=[],this.pageNum=1,this.data={},this.selectorStr="",this.head=[],this.isPageNecessary=!1}Table.prototype.init=function(e,t){this.initData(e,t),this.render()},Table.prototype.update=function(e){this.updateData(e),this.render()},Table.prototype.render=function(){layer.msg("加载中...",{icon:16,shade:.01,time:0});let e=this.renderHead(),t=this.renderBody(),a=this.renderPager(),n=$('<table class="table table-hover table-bordered rounded"></table>'),i=$('<div class="table-responsive"></talbe>');n.append(e).append(t),i.append(n),$(this.selectorStr).empty().addClass("b4-table m-3").append(i).append(a),layer.closeAll()},Table.prototype.renderPager=function(){if(this.isPageNecessary){let e=$('<div class="b4-page clearfix"></div>'),t=Math.ceil(this.data.body.length/10),a=this.pagerDOM(t);return e.append(a),e}return null},Table.prototype.pagerDOM=function(e){let t=this,a=$(`\n        <div class="b4-pager">\n        <div class="btn-toolbar">\n        <div class="btn-group">\n        <button type="button" class="btn btn-outline-primary">首页</button>\n        <button type="button" class="btn btn-outline-primary">上一页</button>\n        <div class="input-group">\n        <span>当前第</span>\n        <input type="number" step="1" min="1" max="${e}" class="form-control p-0" value="${this.pageNum}">\n        <span>页，共 ${e} 页</span>\n        </div>\n        <button type="button" class="btn btn-outline-primary">下一页</button>\n        <button type="button" class="btn btn-outline-primary">末页</button>\n        </div>\n        </div>\n        </div>`);a.find("button:eq(0)").prop("disabled",!1),a.find("button:eq(1)").prop("disabled",!1),a.find("button:eq(2)").prop("disabled",!1),a.find("button:eq(3)").prop("disabled",!1),1==this.pageNum?(a.find("button:eq(0)").prop("disabled",!0),a.find("button:eq(1)").prop("disabled",!0)):this.pageNum==e&&(a.find("button:eq(2)").prop("disabled",!0),a.find("button:eq(3)").prop("disabled",!0));return a.find('input[type="number"]').keydown(function(a){if(13==a.keyCode){let a=Number($(this).val());a>e||a<1?layer.msg("请输入合法数值！",{icon:5,time:2e3}):(t.pageNum=a,t.dataRendering=t.deepSave(t.data.body).slice(10*(a-1),10*a),t.render())}}).blur(function(){$(this).val(t.pageNum)}),a.find("button:eq(0)").click(function(){t.pageNum=1,t.dataRendering=t.deepSave(t.data.body).slice(10*(t.pageNum-1),10*t.pageNum),t.render()}),a.find("button:eq(1)").click(function(){t.pageNum=Number(a.find('input[type="number"]').val())-1,t.dataRendering=t.deepSave(t.data.body).slice(10*(t.pageNum-1),10*t.pageNum),t.render()}),a.find("button:eq(2)").click(function(){t.pageNum=Number(a.find('input[type="number"]').val())+1,t.dataRendering=t.deepSave(t.data.body).slice(10*(t.pageNum-1),10*t.pageNum),t.render()}),a.find("button:eq(3)").click(function(){t.pageNum=e,t.dataRendering=t.deepSave(t.data.body).slice(10*(t.pageNum-1),t.data.body.length),t.render()}),a},Table.prototype.renderBody=function(){let e=$("<tbody></tbody>"),t=[];t=this.isPageNecessary?this.deepSave(this.dataRendering):this.deepSave(this.data.body);for(let a=0;a<t.length;++a){let n=$("<tr></tr>");for(let e=0;e<this.head.length;++e)n.append($("<td>"+t[a][this.head[e].field]+"</td>"));e.append(n)}return e},Table.prototype.renderHead=function(){let e=$("<thead><tr></tr></thead>");for(let t=0;t<this.head.length;++t)e.find("tr").append($("<th>"+this.head[t].title+"</th>"));return e},Table.prototype.updateData=function(e){this.data.body=this.deepSave(e),this.pageNum=1,this.isPageNecessary=e.length>10,this.isPageNecessary?this.dataRendering=this.deepSave(e).slice(0,10):this.dataRendering=[]},Table.prototype.initData=function(e,t){this.selectorStr=e,this.data=this.deepSave(t);for(let e=0;e<t.head.length;++e)this.head.push(t.head[e]);this.isPageNecessary=t.body.length>10,this.isPageNecessary?this.dataRendering=this.deepSave(t.body).slice(0,10):this.dataRendering=[]},Table.prototype.deepSave=function(e){return JSON.parse(JSON.stringify(e))};