/*
  * b4-table - An extended Bootstrap table based on boostrap4.
  *
  * @version v0.0.2
  * @author Hikamai <1450206741@qq.com> (https://github.com/Gu-Miao)
  * @github (https://github.com/Gu-Miao/b4-table)
  * @license MIT
  */
 function Table(){this.dataRendering=[],this.pageNum=1,this.data={},this.selectorStr="",this.head=[],this.isPageNecessary=!1,this.newClick=null,this.previewClick=null,this.changeClick=null,this.deleteClick=null}Table.prototype.init=function(e,t){this.initData(e,t),this.render()},Table.prototype.update=function(e){this.updateData(e),this.render()},Table.prototype.render=function(){let e=$('\n        <div class="opreator">\n            <button class="btn btn-primary mr-3">新增</button>\n        </div>\n    ');e.find("button").click(this.newClick),layer.msg("加载中...",{icon:16,shade:.01,time:0});let t=this.renderHead(),n=this.renderBody(),i=this.renderPager(),a=$('<table class="table table-hover table-bordered rounded"></table>'),d=$('<div class="table-responsive"></talbe>');a.append(t).append(n),d.append(e),d.append(a),$(this.selectorStr).empty().addClass("b4-table m-3").append(d).append(i),layer.closeAll()},Table.prototype.renderPager=function(){if(this.isPageNecessary){let e=$('<div class="b4-page clearfix"></div>'),t=Math.ceil(this.data.body.length/10),n=this.pagerDOM(t);return e.append(n),e}return null},Table.prototype.pagerDOM=function(e){let t=this,n=$(`\n        <div class="b4-pager">\n        <div class="btn-toolbar">\n        <div class="btn-group">\n        <button type="button" class="btn btn-outline-primary">首页</button>\n        <button type="button" class="btn btn-outline-primary">上一页</button>\n        <div class="input-group">\n        <span>当前第</span>\n        <input type="number" step="1" min="1" max="${e}" class="form-control p-0" value="${this.pageNum}">\n        <span>页，共 ${e} 页</span>\n        </div>\n        <button type="button" class="btn btn-outline-primary">下一页</button>\n        <button type="button" class="btn btn-outline-primary">末页</button>\n        </div>\n        </div>\n        </div>`);n.find("button:eq(0)").prop("disabled",!1),n.find("button:eq(1)").prop("disabled",!1),n.find("button:eq(2)").prop("disabled",!1),n.find("button:eq(3)").prop("disabled",!1),1==this.pageNum?(n.find("button:eq(0)").prop("disabled",!0),n.find("button:eq(1)").prop("disabled",!0)):this.pageNum==e&&(n.find("button:eq(2)").prop("disabled",!0),n.find("button:eq(3)").prop("disabled",!0));return n.find('input[type="number"]').keydown(function(n){if(13==n.keyCode){let n=Number($(this).val());n>e||n<1?layer.msg("请输入合法数值！",{icon:5,time:2e3}):(t.pageNum=n,t.dataRendering=t.deepSave(t.data.body).slice(10*(n-1),10*n),t.render())}}).blur(function(){$(this).val(t.pageNum)}),n.find("button:eq(0)").click(function(){t.pageNum=1,t.dataRendering=t.deepSave(t.data.body).slice(10*(t.pageNum-1),10*t.pageNum),t.render()}),n.find("button:eq(1)").click(function(){t.pageNum=Number(n.find('input[type="number"]').val())-1,t.dataRendering=t.deepSave(t.data.body).slice(10*(t.pageNum-1),10*t.pageNum),t.render()}),n.find("button:eq(2)").click(function(){t.pageNum=Number(n.find('input[type="number"]').val())+1,t.dataRendering=t.deepSave(t.data.body).slice(10*(t.pageNum-1),10*t.pageNum),t.render()}),n.find("button:eq(3)").click(function(){t.pageNum=e,t.dataRendering=t.deepSave(t.data.body).slice(10*(t.pageNum-1),t.data.body.length),t.render()}),n},Table.prototype.renderBody=function(){let e=$("<tbody></tbody>"),t=[];t=this.isPageNecessary?this.deepSave(this.dataRendering):this.deepSave(this.data.body);for(let n=0;n<t.length;++n){let i=$("<tr></tr>");for(let e=0;e<this.head.length;++e)i.append($("<td>"+t[n][this.head[e].field]+"</td>"));i.append($('\n            <td class="">\n                <i class="icon iconfont icon-preview"></i>\n                <i class="icon iconfont icon-change"></i>\n                <i class="icon iconfont icon-delete"></i>\n            </td>')),i.find("i:eq(0)").click(this.previewClick),i.find("i:eq(1)").click(this.changeClick),i.find("i:eq(2)").click(this.deleteClick),e.append(i)}return e},Table.prototype.renderHead=function(){let e=$("<thead><tr></tr></thead>");for(let t=0;t<this.head.length;++t)e.find("tr").append($("<th>"+this.head[t].title+"</th>"));return e.find("tr").append($("<th>操作</th>")),e},Table.prototype.updateData=function(e){this.data.body=this.deepSave(e),this.pageNum=1,this.isPageNecessary=e.length>10,this.isPageNecessary?this.dataRendering=this.deepSave(e).slice(0,10):this.dataRendering=[]},Table.prototype.initData=function(e,t){this.selectorStr=e,this.data=this.deepSave(t);for(let e=0;e<t.head.length;++e)this.head.push(t.head[e]);this.isPageNecessary=t.body.length>10,this.isPageNecessary?this.dataRendering=this.deepSave(t.body).slice(0,10):this.dataRendering=[],this.newClick=t.newClick,this.previewClick=t.previewClick,this.changeClick=t.changeClick,this.deleteClick=t.deleteClick},Table.prototype.deepSave=function(e){return JSON.parse(JSON.stringify(e))};